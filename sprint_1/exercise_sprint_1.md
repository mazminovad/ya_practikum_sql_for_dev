# Задания
В самостоятельном проекте вы создадите БД, нормализуете её, наполните данными и выполните шесть заданий на выборку данных из базы.

# Выполните проект в два этапа.
## Этап 1. Создание и заполнение БД
На этом этапе вам нужно создать базу данных, схемы и таблицы и заполнить их данными. 
Названия полей в таблицах должны быть на английском языке — помните о принципах наименования объектов. Правильные названия полей облегчают поддержку вашей БД и повышают читабельность кода.

## Вот пошаговая инструкция:
## Шаг 1. Создайте БД с именем sprint_1. 
Всю работу выполните в этой БД, команду создания БД в итоговый скрипт включать не нужно.
## Шаг 2. Создайте схему raw_data и таблицу sales для загрузки сырых данных в этой схеме. 
Начиная с этого пункта (включительно) все SQL-команды должны быть в итоговом скрипте.
## Шаг 3. Скачайте и проанализируйте исходный csv-файл. (cars.csv)
## Шаг 4. Заполните таблицу sales данными, используя команду COPY в менеджере БД (например, pgAdmin) или \copy в psql. 
Если возникнет ошибка о лишних данных в исходном файле, укажите явно параметр DELIMITER.
## Шаг 5. Проанализируйте сырые данные. Подумайте:
 - какие данные повторяются и их стоит вынести в отдельные таблицы;
 - какие типы данных должны быть у каждого поля;
 - на какие поля стоит добавить ограничения (CONSTRAINTS);
 - какие поля могут содержать NULL, а где нужно добавить ограничение NOT NULL.

## Шаг 6. Создайте схему car_shop, а в ней cоздайте нормализованные таблицы (до третьей нормальной формы). 
Подумайте, какие поля будут выступать первичными ключами, а какие внешними. У всех первичных ключей должен быть автоинкремент.

## Шаг 7. Выберите наиболее подходящий формат данных для каждой колонки. Используя комментарий (-- comment), для каждого поля напишите, почему вы выбрали тот или иной тип данных. Например:
 - brand_name varchar(50) — не существует названий брендов длиной более 50 символов, в названии бренда могут быть и цифры, и буквы, поэтому выбираем varchar(50).
- price numeric(9, 2) — цена может содержать только сотые и не может быть больше семизначной суммы. У numeric повышенная точность при работе с дробными числами, поэтому при операциях c этим типом данных, дробные числа не потеряются.
## Шаг 8. Заполните все таблицы данными, c помощью команд INSERT INTO … SELECT …. 
Чтобы разбить столбец с маркой, моделью машины и её цветом, можно использовать разные способы — выбирайте любой, удобный для себя.

# Этап 2. Создание выборок

Вы создали таблицы и заполнили их данными — браво! Теперь выполните задания на выборку данных для аналитики. Все запросы выполните к созданным таблицам, а не к сырым данным:

## Задание 1

Напишите запрос, который выведет процент моделей машин, у которых нет параметра gasoline_consumption.
Вот формат итоговой таблицы:

| nulls_percentage_gasoline_consumption |
|---------------------------------------|
|Число|

## Задание 2

Напишите запрос, который покажет название бренда и среднюю цену его автомобилей в разбивке по всем годам с учётом скидки. Итоговый результат отсортируйте по названию бренда и году в восходящем порядке. Среднюю цену округлите до второго знака после запятой.
Вот формат итоговой таблицы:

|brand_name|	year	|price_avg|
|----------|------|--------- |
|Audi|	2015|	Средняя цена|
|Audi|	…	|Средняя цена|
|Audi|	2023|	Средняя цена|
|BMW|	2015|	Средняя цена|
|BMW	|…	|Средняя цена|
|BMW|	2023|	Средняя цена|
|Hyundai|	2015|	Средняя цена|
|Hyundai|	…	|Средняя цена|
|Hyundai|	2023|	Средняя цена|

## Задание 3

Посчитайте среднюю цену всех автомобилей с разбивкой по месяцам в 2022 году с учётом скидки. Результат отсортируйте по месяцам в восходящем порядке. Среднюю цену округлите до второго знака после запятой.

Вот формат итоговой таблицы:

|month	|year|	price_avg|
|------|----|---------|
|1	|2022|	Средняя цена|
|2	|2022|	Средняя цена|
|3	|2022|	Средняя цена|
|…	|2022|	Средняя цена|
|12	|2022|	Средняя цена|

## Задание 4

Используя функцию STRING_AGG, напишите запрос, который выведет список купленных машин у каждого пользователя через запятую. Пользователь может купить две одинаковые машины — это нормально. Название машины покажите полное, с названием бренда — например: Tesla Model 3. Отсортируйте по имени пользователя в восходящем порядке. Сортировка внутри самой строки с машинами не нужна.

Вот формат итоговой таблицы:

|person|	cars|
|------|------|
|Alexander Kozlov|	Lada Vesta|
|John Doe|	Audi A3, Lada Samara|
|Ivan Petrov|	Audi S3|

## Задание 5

Напишите запрос, который вернёт самую большую и самую маленькую цену продажи автомобиля с разбивкой по стране без учёта скидки. Цена в колонке price дана с учётом скидки.

Вот формат итоговой таблицы:

|brand_origin|	price_max|	price_min|
|-------------|---------|----------|
|USA	|Максимальная_цена	|Минимальная_цена|
|Germany	|Максимальная_цена	|Минимальная_цена|
|South Korea|	Максимальная_цена	|Минимальная_цена|
|Russia	|Максимальная_цена	|Минимальная_цена|


## Задание 6

Напишите запрос, который покажет количество всех пользователей из США. Это пользователи, у которых номер телефона начинается на +1.

Вот формат итоговой таблицы:

|persons_from_usa_count|
|--------------------|
|число|




# Как оформить решение
- Создайте .sql файл. В файле должны быть:
- Запросы на создание таблиц и схем.
- Запросы на заполнение таблиц данными.
- Запросы на аналитику в порядке их выполнения.
- Команда COPY для заполнения таблицы с сырыми данными из csv-файла.
- Запросы разделите с помощью ‘;’.
- Весь SQL-скрипт должен выполняться без ошибок.
